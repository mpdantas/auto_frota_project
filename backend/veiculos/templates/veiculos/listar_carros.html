{% extends 'core/base.html' %} {# Estende o template base #}
{% load static %} {# Necessário para usar {% static %} #}

{% block title %}Lista de Veículos{% endblock %} {# Título da página #}

{% block extra_css %}
{# Este bloco está vazio, pois o CSS está no main.css #}
{% endblock extra_css %}

{% block content %}
    <div class="vehicle-list-container">
        <h2>Lista de Veículos Ativos</h2>
        
        {# Exibe mensagens do Django (sucesso, erro, etc.) #}
        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <form method="get" class="search-form">
            <input type="search" name="q" placeholder="Buscar por placa, modelo ou chassi..." 
                   value="{{ query|default:'' }}" aria-label="Termo de busca">
            <button type="submit">Buscar</button>
        </form>

        <p class="count">Total de carros ativos: {{ quantidade_carros }}</p>

        {% if veiculos %} {# Verifica se há veículos na lista #}
            <table>
                <thead>
                    <tr>
                        <th>Placa</th>
                        <th>Modelo</th>
                        <th>Marca</th>
                        <th>Empresa</th>
                        <th>Condutor</th>
                        <th>Seguradora</th>
                        <th>Franquia</th>
                        <th>Classe Bônus</th>
                        <th>Vencimento Seguro</th>
                        <th>Ativo</th>
                        <th>Ações</th> {# COLUNA PARA BOTÕES DE AÇÃO #}
                    </tr>
                </thead>
                <tbody>
                    {% for veiculo in veiculos %}
                    <tr>
                        <td>{{ veiculo.placa }}</td>
                        <td>{{ veiculo.modelo }}</td>
                        <td>{{ veiculo.marca }}</td>
                        <td>{{ veiculo.empresa.razao_social }}</td> {# Acessa a Razão Social da Empresa relacionada #}
                        <td>{{ veiculo.nome_condutor|default:"Não informado" }}</td> {# Exibe "Não informado" se campo estiver vazio #}
                        <td>{{ veiculo.seguradora }}</td>
                        <td>R$ {{ veiculo.franquia|floatformat:2 }}</td> {# Formata como moeda #}
                        <td>{{ veiculo.classe_bonus }}</td>
                        <td>{{ veiculo.data_vencimento_seguro|date:"d/m/Y" }}</td> {# Formata a data #}
                        <td>{% if veiculo.ativo %}Sim{% else %}Não{% endif %}</td>
                        <td> {# CÉLULA DE AÇÕES #}
                            {# Botão para Editar o veículo #}
                            <a href="{% url 'veiculos:editar_carro' pk=veiculo.pk %}" class="action-button edit">Editar</a>
                            
                            {# Botão para Desativar o veículo #}
                            {# Usa um formulário POST para segurança, e um confirm JavaScript #}
                            <form action="{% url 'veiculos:excluir_carro' pk=veiculo.pk %}" method="post" style="display:inline;">
                                {% csrf_token %} {# Token de segurança CSRF #}
                                <button type="submit" class="action-button delete" 
                                        onclick="return confirm('Tem certeza que deseja desativar o veículo {{ veiculo.placa }}? Esta ação não pode ser desfeita diretamente por aqui.');">
                                    Desativar
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-vehicles">Nenhum veículo ativo registrado no sistema.</p>
        {% endif %}
    </div>
{% endblock content %}

{% block extra_js %}
{# Este bloco está vazio, a menos que você adicione JS específico aqui #}
{% endblock extra_js %}